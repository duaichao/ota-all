<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="produceRoute">

	<insert id="saveWapRecommendCityDao" parameterClass="java.util.Map">
		INSERT INTO SD_WAP_RECOMMEND_CITY (
			ID,
			ROUTE_ID,
			WAP_ID,
			CITY_NAME,
			CATEGORY_ID
		) VALUES(
			#ID#,
			#ROUTE_ID#,
			#WAP_ID#,
			#CITY_NAME#,
			#CATEGORY_ID#
		)
	</insert>
	
	<delete id="delWapRecommendCityDao" parameterClass="java.util.Map">
		DELETE FROM SD_WAP_RECOMMEND_CITY WHERE WAP_ID = #WAP_ID# AND ROUTE_ID = #ROUTE_ID# AND CATEGORY_ID = #CATEGORY_ID#
	</delete>
	
	<statement id="listRenewDao" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select a.* from (select a.*, rownum as myrownum from (
			select * from (
				SELECT a.ID,
					a.NO,
					a.TITLE,
					a.RETAIL_SINGLE_ROOM,
					a.INTER_SINGLE_ROOM,
					a.TYPE,
					a.ATTR,
					h2.THEMES,
					h3.BEGIN_CITY,
					h4.END_CITY,
					a.FEATURE,
					a.NOTICE,
					c.CHINA_NAME as PORDUCE_CONCAT,
					c.MOBILE as PRODUCE_MOBILE,
					a.CREATE_USER_ID,
					a.COMPANY_ID,
					a.COMPANY_NAME
				FROM
				  (
				  <isNotEmpty property="IS_ALONE">
					  SELECT a.ID,
							a.NO,
							a.TITLE,
							a.COMPANY_ID,
							a.CREATE_USER_ID,
							a.RETAIL_SINGLE_ROOM,
							a.INTER_SINGLE_ROOM,
							a.TYPE,
							a.ATTR,
							a.FEATURE,
							a.NOTICE,
							a.COMPANY_NAME
					  FROM sd_pro_route a, sd_user_company b
					  WHERE a.IS_SHARE = 1
					  AND a.IS_DEL     =0
					  AND a.IS_PUB     =1
					  and a.COMPANY_ID = b.id
					  <isNotEmpty property="CITY_IDS">
					  and a.CITY_ID in ($CITY_IDS$)
					  </isNotEmpty>
					  <isNotEmpty property="CITY_ID">
					  and a.CITY_ID = #CITY_ID#
					  </isNotEmpty>
					  UNION
				  </isNotEmpty>
				  SELECT a.ID,
					a.NO,
					a.TITLE,
					a.COMPANY_ID,
					a.CREATE_USER_ID,
					a.RETAIL_SINGLE_ROOM,
					a.INTER_SINGLE_ROOM,
					a.TYPE,
					a.ATTR,
					a.FEATURE,
					a.NOTICE,
					a.COMPANY_NAME
				  FROM SD_PRO_ROUTE a,
				    SD_PRO_ROUTE_GRANT b
				  WHERE a.ID       = b.ROUTE_ID
				  AND a.IS_DEL     =0
				  AND a.IS_PUB     =1
				  <isNotEmpty property="COMPANY_ID">
				  and b.COMPANY_ID = #COMPANY_ID#
				  </isNotEmpty> 
				  <isNotEmpty property="CITY_IDS">
				  and a.CITY_ID in ($CITY_IDS$)
				  </isNotEmpty>
				  <isNotEmpty property="CITY_ID">
				  and a.CITY_ID = #CITY_ID#
				  </isNotEmpty>
				  ) a,
				   SD_USER c, SD_USER_COMPANY d,
				   (SELECT route_id,
				    LTRIM(MAX(SYS_CONNECT_BY_PATH(tag_name, ',')), ',') themes
				  FROM
				    (SELECT tag_name,
				      route_id,
				      ROW_NUMBER() OVER(PARTITION BY route_id ORDER BY tag_name DESC) RN
				    FROM sd_pro_route_tag
				    )
				    START WITH RN     = 1
				    CONNECT BY RN - 1 = PRIOR RN
				  AND route_id        = PRIOR route_id
				  GROUP BY route_id
				  )h2,
				   (SELECT route_id,
				    LTRIM(MAX(SYS_CONNECT_BY_PATH(CITY_NAME, ',')), ',') begin_city
				  FROM
				    (SELECT CITY_NAME,
				      route_id,
				      ROW_NUMBER() OVER(PARTITION BY route_id ORDER BY CITY_NAME DESC) RN
				    FROM SD_PRO_ROUTE_CITY
				    WHERE type = 1
				    )
				    START WITH RN     = 1
				    CONNECT BY RN - 1 = PRIOR RN
				  AND route_id        = PRIOR route_id
				  GROUP BY route_id
				  )h3,
				  (SELECT route_id,
				    LTRIM(MAX(SYS_CONNECT_BY_PATH(CITY_NAME, ',')), ',') end_city
				  FROM
				    (SELECT CITY_NAME,
				      route_id,
				      ROW_NUMBER() OVER(PARTITION BY route_id ORDER BY CITY_NAME DESC) RN
				    FROM SD_PRO_ROUTE_CITY
				    WHERE type = 2
				    )
				    START WITH RN     = 1
				    CONNECT BY RN - 1 = PRIOR RN
				  AND route_id        = PRIOR route_id
				  GROUP BY route_id
				  )h4
				WHERE a.CREATE_USER_ID = c.ID and a.COMPANY_ID = d.ID
				AND a.id             = h2.ROUTE_ID(+)
				AND a.id             = h3.ROUTE_ID(+)
				AND a.id             = h4.ROUTE_ID(+)
				<isNotEmpty property="query">
					AND ( a.TITLE         like '%$query$%' or a.NO like '%$query$%')
				</isNotEmpty>
				<isNotEmpty property="ID">
					AND a.ID = #ID#
				</isNotEmpty>
			) a where 1 = 1 
  		)a)a where 1 = 1 <![CDATA[  and a.myrownum >= #start# and a.myrownum <= #end# ]]>
	</statement>
	
	<statement id="countRenewDao" parameterClass="java.util.Map" resultClass="java.lang.Integer">
				SELECT count(1) as cnt
				FROM
				  (
				  <isNotEmpty property="IS_ALONE">
					  SELECT a.ID,
							a.NO,
							a.TITLE,
							a.COMPANY_ID,
							a.CREATE_USER_ID
					  FROM sd_pro_route a, sd_user_company b
					  WHERE a.IS_SHARE = 1
					  AND a.IS_DEL     =0
					  AND a.IS_PUB     =1
					  and a.COMPANY_ID = b.id
					  <isNotEmpty property="CITY_IDS">
					  and a.CITY_ID in ($CITY_IDS$)
					  </isNotEmpty>
					  <isNotEmpty property="CITY_ID">
					  and a.CITY_ID = #CITY_ID#
					  </isNotEmpty>
					  UNION
				  </isNotEmpty>
				  SELECT a.ID,
					a.NO,
					a.TITLE,
					a.COMPANY_ID,
					a.CREATE_USER_ID
				  FROM SD_PRO_ROUTE a,
				    SD_PRO_ROUTE_GRANT b
				  WHERE a.ID       = b.ROUTE_ID
				  AND a.IS_DEL     =0
				  AND a.IS_PUB     =1
				  <isNotEmpty property="COMPANY_ID">
				  and b.COMPANY_ID = #COMPANY_ID#
				  </isNotEmpty> 
				  <isNotEmpty property="CITY_IDS">
				  and a.CITY_ID in ($CITY_IDS$)
				  </isNotEmpty>
				  <isNotEmpty property="CITY_ID">
				  and a.CITY_ID = #CITY_ID#
				  </isNotEmpty>
				  ) a,
				   SD_USER c, SD_USER_COMPANY d
				WHERE a.CREATE_USER_ID = c.ID and a.COMPANY_ID = d.ID
				<isNotEmpty property="query">
					AND ( a.TITLE         like '%$query$%' or a.NO like '%$query$%')
				</isNotEmpty>
	</statement>
	
	<statement id="listDao" parameterClass="java.util.Map" resultClass="java.util.HashMap" remapResults="true">
		select a.* from (select a.*, rownum as myrownum from (
			select * from (
				SELECT a.ID,
					d.BRAND_NAME,
					d.COMPANY,
					a.NO,
					a.IS_EARNEST,
				    a.EARNEST_INTER,
				    a.EARNEST_RETAIL,
				    a.EARNEST_DAY_COUNT,
				    a.EARNEST_TYPE,
					a.FACE,
					a.TITLE,
					a.FEATURE,
					a.NOTICE,
					a.TYPE,
					a.COMPANY_ID,
					a.COMPANY_NAME,
					c.china_name as PORDUCE_CONCAT,
					c.mobile as PRODUCE_MOBILE,
					c.PHONE,
					a.CREATE_USER,
					TO_CHAR(a.CREATE_TIME, 'yyyy-mm-dd hh24:mm:ss') CREATE_TIME,
					a.CREATE_USER_ID,
					a.UPDATE_USER,
					TO_CHAR(a.UPDATE_TIME, 'yyyy-mm-dd hh24:mm:ss') UPDATE_TIME,
					a.UPDATE_USER_ID,
					a.CITY_ID,
					a.CITY_NAME,
					a.IS_DEL,
					a.IS_PUB,
					a.SOURCE_URL,
					a.IS_SINGLE_PUB,
					a.IS_GRANT,
					a.IS_SHARE,
					a.DAY_COUNT,
					a.ATTR,
					a.RETAIL_SINGLE_ROOM,
					a.INTER_SINGLE_ROOM,
					b.ROUTE_PRICE,
				    b.ROUTE_INTER_PRICE,
					b.SUM_PRICE ,
					b.SUM_INTER_PRICE,
					a.IS_OTHER_FEE,
					to_char(to_date(b.rq, 'YYYY/MM/DD'),'YYYY/MM/DD') as RQ,
					c.QQ1,
					c.QQ2,
					DECODE(h.ROUTE_TRAFFIC_CNT, null, 0, h.ROUTE_TRAFFIC_CNT) ROUTE_TRAFFIC_CNT,
     		        DECODE(h1.BASE_PRICE_CNT, null, 0, h1.BASE_PRICE_CNT) BASE_PRICE_CNT,
					h2.THEMES,
					h3.BEGIN_CITY,
					h4.END_CITY,
					h5.DISCOUNT_INFO,
			  		h5.DISCOUNT_ID,
			  		h6.PRICE as ROUTE_WAP_PRICE,
			  		a.IS_FULL_PRICE
			  		<isNotEmpty property="ORDER">
			  		,t6.ORDER_CNT
			  		</isNotEmpty>
				FROM
				  (
				  <isNotEmpty property="IS_ALONE">
					  SELECT a.ID,
							a.NO,
							a.IS_EARNEST,
						    a.EARNEST_INTER,
						    a.EARNEST_RETAIL,
						    a.EARNEST_DAY_COUNT,
						    a.EARNEST_TYPE,
							a.FACE,
							a.TITLE,
							a.FEATURE,
							a.NOTICE,
							a.TYPE,
							a.COMPANY_ID,
							a.COMPANY_NAME,
							a.PORDUCE_CONCAT,
							a.PRODUCE_MOBILE,
							a.CREATE_USER,
							a.CREATE_TIME,
							a.CREATE_USER_ID,
							a.UPDATE_USER,
							a.UPDATE_TIME,
							a.CITY_ID,
							a.CITY_NAME,
							a.IS_DEL,
							a.IS_PUB,
							a.SOURCE_URL,
							a.IS_SINGLE_PUB,
							a.IS_GRANT,
							a.IS_SHARE,
							a.UPDATE_USER_ID,
							a.DAY_COUNT,
							a.ATTR,
							a.CITY_NUM,
							a.SINGLE_REMARK,
							a.RETAIL_SINGLE_ROOM,
							a.INTER_SINGLE_ROOM,
							a.IS_OTHER_FEE,
							a.IS_FULL_PRICE
					  FROM sd_pro_route a, sd_user_company b
					  WHERE a.IS_SHARE = 1
					  AND a.IS_DEL     =0
					  AND a.IS_PUB     =1
					  and a.COMPANY_ID = b.id
					  <isNotEmpty property="ID">
					  and a.ID = #ID#
					  </isNotEmpty>
					  <isNotEmpty property="CITY_IDS">
					  and a.CITY_ID in ($CITY_IDS$)
					  </isNotEmpty>
					  <isNotEmpty property="CITY_ID">
					  and a.CITY_ID = #CITY_ID#
					  </isNotEmpty>
					  UNION
				  </isNotEmpty>
				  SELECT a.ID,
					a.NO,
					a.IS_EARNEST,
				    a.EARNEST_INTER,
				    a.EARNEST_RETAIL,
				    a.EARNEST_DAY_COUNT,
				    a.EARNEST_TYPE,
					a.FACE,
					a.TITLE,
					a.FEATURE,
					a.NOTICE,
					a.TYPE,
					a.COMPANY_ID,
					a.COMPANY_NAME,
					a.PORDUCE_CONCAT,
					a.PRODUCE_MOBILE,
					a.CREATE_USER,
					a.CREATE_TIME,
					a.CREATE_USER_ID,
					a.UPDATE_USER,
					a.UPDATE_TIME,
					a.CITY_ID,
					a.CITY_NAME,
					a.IS_DEL,
					a.IS_PUB,
					a.SOURCE_URL,
					a.IS_SINGLE_PUB,
					a.IS_GRANT,
					a.IS_SHARE,
					a.UPDATE_USER_ID,
					a.DAY_COUNT,
					a.ATTR,
					a.CITY_NUM,
					a.SINGLE_REMARK,
					a.RETAIL_SINGLE_ROOM,
					a.INTER_SINGLE_ROOM,
					a.IS_OTHER_FEE,
					a.IS_FULL_PRICE
				  FROM SD_PRO_ROUTE a,
				    SD_PRO_ROUTE_GRANT b
				  WHERE a.ID       = b.ROUTE_ID
				  AND a.IS_DEL     =0
				  AND a.IS_PUB     =1
				  <isNotEmpty property="ID">
				  and a.ID = #ID#
				  </isNotEmpty>
				  <isNotEmpty property="COMPANY_ID">
				  and b.COMPANY_ID = #COMPANY_ID#
				  </isNotEmpty> 
				  <isNotEmpty property="CITY_IDS">
				  and a.CITY_ID in ($CITY_IDS$)
				  </isNotEmpty>
				  <isNotEmpty property="CITY_ID">
				  and a.CITY_ID = #CITY_ID#
				  </isNotEmpty>
				  ) a,
				  (SELECT a.ROUTE_ID,
				    a.RQ,
				    a.ACTUAL_PRICE,
				    a.ACTUAL_INTER_PRICE,
				    a.PLANID,
				    a.RN,
				    b.ROUTE_PRICE,
				    b.ROUTE_INTER_PRICE,
				    (a.ACTUAL_PRICE       + b.ROUTE_PRICE) SUM_PRICE,
				    (a.ACTUAL_INTER_PRICE + b.ROUTE_INTER_PRICE) SUM_INTER_PRICE
				  FROM
				    (SELECT a.ROUTE_ID,
				      a.RQ,
				      a.ACTUAL_PRICE,
				      a.ACTUAL_INTER_PRICE,
				      a.PLANID,
				      a.RN
				    FROM
				      (SELECT a.ROUTE_ID,
				        a.RQ,
				        a.ACTUAL_PRICE,
				        a.ACTUAL_INTER_PRICE,
				        a.PLANID,
				        ROW_NUMBER() OVER(PARTITION BY a.route_id order by a.rq) AS rn
				      FROM SD_PRO_ROUTE_CALENDAR a
				      <![CDATA[ WHERE TO_CHAR((to_date(TO_CHAR(sysdate, 'yyyymmdd hh24:mi'),'yyyymmdd hh24:mi') + a.DAY_NUM),'yyyymmdd hh24:mi') <= a.rq
					    ||' '
					    || a.END_TIME
					  ]]>
					  
					  <isNotEmpty property="BEGIN_DATE">
					  	and a.RQ >= to_char(to_date(#BEGIN_DATE#, 'yyyy-mm-dd'), 'yyyymmdd')
					  </isNotEmpty>
					  <isNotEmpty property="END_DATE">
					  	<![CDATA[ and a.RQ <= to_char(to_date(#END_DATE#, 'yyyy-mm-dd'), 'yyyymmdd') ]]>
					  </isNotEmpty>
			
				      ) a
				    WHERE rn = 1
				    ) a,
				    (SELECT a.entity_id,
				      SUM(DECODE(a.TYPE_ID, '0FA5123749D28C87E050007F0100BCAD', a.PRICE,0)) AS ROUTE_PRICE,
				      SUM(DECODE(a.TYPE_ID, '0FA5123749D38C87E050007F0100BCAD', a.PRICE,0)) AS ROUTE_INTER_PRICE
				    FROM SD_PRO_BASE_PRICE a
				    WHERE a.ATTR_ID = '0FA5123749CF8C87E050007F0100BCAD'
				    GROUP BY a.ENTITY_ID
				    ) b,
				    sd_pro_route_city_labels c
				    
				  WHERE a.ROUTE_ID = b.ENTITY_ID
				  and a.route_id = c.route_id(+)
				  <isNotEmpty property="LABEL_IDS">
					and 
					 <iterate property="LABEL_IDS" conjunction="or" open="(" close=")">
					 c.label_ids like '%$LABEL_IDS[]$%'
					 </iterate>
				  </isNotEmpty> 
				  ) b, SD_USER c, SD_USER_COMPANY d,
		        (select count(b.id) as ROUTE_TRAFFIC_CNT , b.route_id from sd_pro_route_traffic b, sd_pro_route_traffic_detail c where b.id = c.plan_id and b.is_del = 0 and c.is_del = 0 group by b.route_id) h,

				  (select count(b.id) as BASE_PRICE_CNT,b.entity_id from SD_PRO_BASE_PRICE b group by b.entity_id ) h1,
				
				  (SELECT route_id,
				    LTRIM(MAX(SYS_CONNECT_BY_PATH(tag_name, ',')), ',') themes
				  FROM
				    (SELECT tag_name,
				      route_id,
				      ROW_NUMBER() OVER(PARTITION BY route_id ORDER BY tag_name DESC) RN
				    FROM sd_pro_route_tag
				    )
				    START WITH RN     = 1
				    CONNECT BY RN - 1 = PRIOR RN
				  AND route_id        = PRIOR route_id
				  GROUP BY route_id
				  )h2,
				  (SELECT route_id,
				    LTRIM(MAX(SYS_CONNECT_BY_PATH(CITY_NAME, ',')), ',') begin_city
				  FROM
				    (SELECT CITY_NAME,
				      route_id,
				      ROW_NUMBER() OVER(PARTITION BY route_id ORDER BY CITY_NAME DESC) RN
				    FROM SD_PRO_ROUTE_CITY
				    WHERE type = 1
				    )
				    START WITH RN     = 1
				    CONNECT BY RN - 1 = PRIOR RN
				  AND route_id        = PRIOR route_id
				  GROUP BY route_id
				  )h3,
				  (SELECT route_id,
				    LTRIM(MAX(SYS_CONNECT_BY_PATH(CITY_NAME, ',')), ',') end_city
				  FROM
				    (SELECT CITY_NAME,
				      route_id,
				      ROW_NUMBER() OVER(PARTITION BY route_id ORDER BY CITY_NAME DESC) RN
				    FROM SD_PRO_ROUTE_CITY
				    WHERE type = 2
				    )
				    START WITH RN     = 1
				    CONNECT BY RN - 1 = PRIOR RN
				  AND route_id        = PRIOR route_id
				  GROUP BY route_id
				  )h4,
				  (SELECT t.PRO_ID,
			  t.DISCOUNT_ID,
			  t.title||'('||MAX(SYS_CONNECT_BY_PATH(t.discount_info, ' 套餐*：'))||')' as discount_info
			FROM
			  (SELECT t.PRO_ID,
			    t.DISCOUNT_ID,
			    t1.title,
			    DECODE(t2.PLATFROM, '1','B2B','APP') || DECODE(t2.PAY_WAY, '1','在线支付','余额支付') || ' 优惠: ' || to_char(t2.MONEY,'fm99999990.99')|| DECODE(t2.rule_type, '1', '元', '2', '%', '元/人') as discount_info,
			    ROW_NUMBER() OVER(PARTITION BY t.PRO_ID order by t1.title) RN
			  FROM SD_DISCOUNT_PRODUCT t,
			    SD_DISCOUNT t1,
			    sd_discount_rule t2
			  WHERE t.discount_id    = t1.id
			  AND t.discount_rule_id = t2.id
			  AND t1.is_use          = 0
			  AND t2.is_use          = 0
			  <![CDATA[  AND t1.BEGIN_TIME <= sysdate ]]>
			  AND t1.END_TIME   >= sysdate
			  ) t
			  START WITH t.RN     = 1
			  CONNECT BY t.RN - 1 = PRIOR t.RN
			AND t.PRO_ID          = PRIOR t.PRO_ID
			GROUP BY t.PRO_ID,
			  t.DISCOUNT_ID,
			  t.title) h5,
			  (select * from sd_wap_price where AGENCY_ID = #AGENCY_ID#) h6
			  <isNotEmpty property="ORDER">
			  	,(select count(1) as order_cnt, t.produce_id from sd_order_base t 
			    where 1 = 1
			    and t.is_del = 0
			    <isNotEmpty property="ORDER_STATUS">
			    	and t.STATUS = #ORDER_STATUS#
			    </isNotEmpty>
			    <isNotEmpty property="BUY_COMPANY_ID">
			    	and t.CREATE_COMPANY_ID = #BUY_COMPANY_ID#
			    </isNotEmpty>
			    group by t.produce_id) t6
			  </isNotEmpty>
				WHERE a.ID = b.ROUTE_ID and a.CREATE_USER_ID = c.ID and a.COMPANY_ID = d.ID
				
				AND a.id             = h.route_id(+)
				AND a.id             = h1.entity_id(+)
				AND a.id             = h2.route_id(+)
				AND a.id             = h3.ROUTE_ID(+)
				AND a.id             = h4.ROUTE_ID(+)
				AND a.id             = h6.PRO_ID(+)
				<isNotEmpty property="DISCOUNT">
				and a.id             = h5.pro_id
				</isNotEmpty>
				<isEmpty property="DISCOUNT">
				and a.id             = h5.pro_id(+)
				</isEmpty>
				<isNotEmpty property="ORDER">
					<isEqual property="ORDER" compareValue="BUY">
						and a.id             = t6.produce_id
					</isEqual>
					<isEqual property="ORDER" compareValue="HOT">
						and a.id             = t6.produce_id(+)
					</isEqual>
				</isNotEmpty>
				
				<isNotEmpty property="query">
					AND ( a.TITLE         like '%$query$%' or a.NO like '%$query$%' or h4.end_city like  '%$query$%')
				</isNotEmpty>
				<isNotEmpty property="BRAND_NAME">
					and 
					 <iterate property="BRAND_NAME" conjunction="or" open="(" close=")">
					 d.BRAND_NAME = #BRAND_NAME[]#
					 </iterate>
				</isNotEmpty>
				<isNotEmpty property="ID">
					and a.ID = #ID#
				</isNotEmpty>
				<isNotEmpty property="ROUTE_TYPE">
					and a.TYPE = #ROUTE_TYPE#
				</isNotEmpty>
				<isNotEmpty property="ATTR">
					and a.ATTR = #ATTR#
				</isNotEmpty>
			) a where 1 = 1 
			<isNotEmpty property="themes">
				and 
				 <iterate property="themes" conjunction="or" open="(" close=")">
				 a.themes like '%$themes[]$%'
				 </iterate>
			</isNotEmpty>
			<isNotEmpty property="attr">
				and a.attr = #attr#
			</isNotEmpty>
			<isNotEmpty property="DAY_COUNT">
				<isEqual property="DAY_COUNT" compareValue="7">
					<![CDATA[ and a.day_count >= 6 ]]>
				</isEqual>
				<isNotEqual property="DAY_COUNT" compareValue="7">
					and a.day_count = #DAY_COUNT#
				</isNotEqual>
			</isNotEmpty>
			<isNotEmpty property="MIN_PRICE">
				and a.SUM_INTER_PRICE >= #MIN_PRICE#
			</isNotEmpty>			
			<isNotEmpty property="MAX_PRICE">
				<![CDATA[ and a.SUM_INTER_PRICE <= #MAX_PRICE# ]]>
			</isNotEmpty>
			<isNotEmpty property="START_CITY_NAME"> 
				 <iterate property="START_CITY_NAME" conjunction="or" open="and (" close=")">
				 a.BEGIN_CITY like '%$START_CITY_NAME[]$%'
				 </iterate>
			</isNotEmpty>
			and a.ROUTE_TRAFFIC_CNT > 0
			ORDER BY 
			<isNotEmpty property="ORDER">
			a.ORDER_CNT DESC,
			</isNotEmpty>
			a.UPDATE_TIME DESC
  		)a)a where 1 = 1 <![CDATA[  and a.myrownum >= #start# and a.myrownum <= #end# ]]>
	</statement>
	
	<statement id="countDao" parameterClass="java.util.Map" resultClass="java.lang.Integer">
		
			select count(1) as cnt from (
				SELECT a.ID,
					a.NO,
					a.FACE,
					a.TITLE,
					a.FEATURE,
					a.NOTICE,
					a.TYPE,
					a.COMPANY_ID,
					a.COMPANY_NAME,
					c.china_name as PORDUCE_CONCAT,
					c.mobile as PRODUCE_MOBILE,
					c.PHONE,
					a.CREATE_USER,
					TO_CHAR(a.CREATE_TIME, 'yyyy-mm-dd hh24:mm:ss') CREATE_TIME,
					a.CREATE_USER_ID,
					a.UPDATE_USER,
					TO_CHAR(a.UPDATE_TIME, 'yyyy-mm-dd hh24:mm:ss') UPDATE_TIME,
					a.UPDATE_USER_ID,
					a.CITY_ID,
					a.CITY_NAME,
					a.IS_DEL,
					a.IS_PUB,
					a.SOURCE_URL,
					a.IS_SINGLE_PUB,
					a.IS_GRANT,
					a.IS_SHARE,
					a.DAY_COUNT,
					a.ATTR,
					a.RETAIL_SINGLE_ROOM,
					a.INTER_SINGLE_ROOM,
					b.ROUTE_PRICE,
				    b.ROUTE_INTER_PRICE,
					b.SUM_PRICE ,
					b.SUM_INTER_PRICE,
					to_char(to_date(b.rq, 'YYYY/MM/DD'),'YYYY/MM/DD') rq,
					c.QQ1,
					c.QQ2,
					DECODE(h.ROUTE_TRAFFIC_CNT, null, 0, h.ROUTE_TRAFFIC_CNT) ROUTE_TRAFFIC_CNT,
     		        DECODE(h1.BASE_PRICE_CNT, null, 0, h1.BASE_PRICE_CNT) BASE_PRICE_CNT,
					h2.themes,
					h3.begin_city,
					h4.end_city,
					h5.discount_info,
			  		h5.DISCOUNT_ID,
			  		h6.price as ROUTE_WAP_PRICE
				FROM
				  (
				  <isNotEmpty property="IS_ALONE">
					  SELECT a.ID,
							a.NO,
							a.FACE,
							a.TITLE,
							a.FEATURE,
							a.NOTICE,
							a.TYPE,
							a.COMPANY_ID,
							a.COMPANY_NAME,
							a.PORDUCE_CONCAT,
							a.PRODUCE_MOBILE,
							a.CREATE_USER,
							a.CREATE_TIME,
							a.CREATE_USER_ID,
							a.UPDATE_USER,
							a.UPDATE_TIME,
							a.CITY_ID,
							a.CITY_NAME,
							a.IS_DEL,
							a.IS_PUB,
							a.SOURCE_URL,
							a.IS_SINGLE_PUB,
							a.IS_GRANT,
							a.IS_SHARE,
							a.UPDATE_USER_ID,
							a.DAY_COUNT,
							a.ATTR,
							a.CITY_NUM,
							a.SINGLE_REMARK,
							a.RETAIL_SINGLE_ROOM,
							a.INTER_SINGLE_ROOM
					  FROM sd_pro_route a, sd_user_company b
					  WHERE a.IS_SHARE = 1
					  AND a.IS_DEL     =0
					  AND a.IS_PUB     =1
					  and a.COMPANY_ID = b.id
					  <isNotEmpty property="ID">
					  and a.ID = #ID#
					  </isNotEmpty>
					  <isNotEmpty property="CITY_IDS">
					  and a.CITY_ID in ($CITY_IDS$)
					  </isNotEmpty>
					  <isNotEmpty property="CITY_ID">
					  and a.CITY_ID = #CITY_ID#
					  </isNotEmpty>
					  UNION
				  </isNotEmpty>
				  SELECT a.ID,
						a.NO,
						a.FACE,
						a.TITLE,
						a.FEATURE,
						a.NOTICE,
						a.TYPE,
						a.COMPANY_ID,
						a.COMPANY_NAME,
						a.PORDUCE_CONCAT,
						a.PRODUCE_MOBILE,
						a.CREATE_USER,
						a.CREATE_TIME,
						a.CREATE_USER_ID,
						a.UPDATE_USER,
						a.UPDATE_TIME,
						a.CITY_ID,
						a.CITY_NAME,
						a.IS_DEL,
						a.IS_PUB,
						a.SOURCE_URL,
						a.IS_SINGLE_PUB,
						a.IS_GRANT,
						a.IS_SHARE,
						a.UPDATE_USER_ID,
						a.DAY_COUNT,
						a.ATTR,
						a.CITY_NUM,
						a.SINGLE_REMARK,
						a.RETAIL_SINGLE_ROOM,
						a.INTER_SINGLE_ROOM
				  FROM SD_PRO_ROUTE a,
				    SD_PRO_ROUTE_GRANT b
				  WHERE a.ID       = b.ROUTE_ID
				  AND a.IS_DEL     =0
				  AND a.IS_PUB     =1
				  <isNotEmpty property="ID">
				  and a.ID = #ID#
				  </isNotEmpty>
				  <isNotEmpty property="COMPANY_ID">
				  and b.COMPANY_ID = #COMPANY_ID#
				  </isNotEmpty> 
				  <isNotEmpty property="CITY_IDS">
				  and a.CITY_ID in ($CITY_IDS$)
				  </isNotEmpty>
				  <isNotEmpty property="CITY_ID">
				  and a.CITY_ID = #CITY_ID#
				  </isNotEmpty>
				  
				  ) a,
				  (SELECT a.ROUTE_ID,
				    a.RQ,
				    a.ACTUAL_PRICE,
				    a.ACTUAL_INTER_PRICE,
				    a.PLANID,
				    a.RN,
				    b.ROUTE_PRICE,
				    b.ROUTE_INTER_PRICE,
				    (a.ACTUAL_PRICE       + b.ROUTE_PRICE) SUM_PRICE,
				    (a.ACTUAL_INTER_PRICE + b.ROUTE_INTER_PRICE) SUM_INTER_PRICE
				  FROM
				    (SELECT a.ROUTE_ID,
				      a.RQ,
				      a.ACTUAL_PRICE,
				      a.ACTUAL_INTER_PRICE,
				      a.PLANID,
				      a.RN
				    FROM
				      (SELECT a.ROUTE_ID,
				        a.RQ,
				        a.ACTUAL_PRICE,
				        a.ACTUAL_INTER_PRICE,
				        a.PLANID,
				        ROW_NUMBER() OVER(PARTITION BY a.route_id order by a.rq) AS rn
				      FROM SD_PRO_ROUTE_CALENDAR a
				      <![CDATA[ WHERE TO_CHAR((to_date(TO_CHAR(sysdate, 'yyyymmdd hh24:mi'),'yyyymmdd hh24:mi') + a.DAY_NUM),'yyyymmdd hh24:mi') <= a.rq
					    ||' '
					    || a.END_TIME
					  ]]>
					  
					  <isNotEmpty property="BEGIN_DATE">
					  	and a.RQ >= to_char(to_date(#BEGIN_DATE#, 'yyyy-mm-dd'), 'yyyymmdd')
					  </isNotEmpty>
					  <isNotEmpty property="END_DATE">
					  	<![CDATA[ and a.RQ <= to_char(to_date(#END_DATE#, 'yyyy-mm-dd'), 'yyyymmdd') ]]>
					  </isNotEmpty>
			
				      ) a
				    WHERE rn = 1
				    ) a,
				    (SELECT a.entity_id,
				      SUM(DECODE(a.TYPE_ID, '0FA5123749D28C87E050007F0100BCAD', a.PRICE,0)) AS ROUTE_PRICE,
				      SUM(DECODE(a.TYPE_ID, '0FA5123749D38C87E050007F0100BCAD', a.PRICE,0)) AS ROUTE_INTER_PRICE
				    FROM SD_PRO_BASE_PRICE a
				    WHERE a.ATTR_ID = '0FA5123749CF8C87E050007F0100BCAD'
				    GROUP BY a.ENTITY_ID
				    ) b,
				    sd_pro_route_city_labels c
				    
				  WHERE a.ROUTE_ID = b.ENTITY_ID
				  and a.route_id = c.route_id(+)
				  <isNotEmpty property="LABEL_IDS">
					and 
					 <iterate property="LABEL_IDS" conjunction="or" open="(" close=")">
					 c.label_ids like '%$LABEL_IDS[]$%'
					 </iterate>
				  </isNotEmpty> 
				  ) b, SD_USER c, SD_USER_COMPANY d,
		        (select count(b.id) as ROUTE_TRAFFIC_CNT , b.route_id from sd_pro_route_traffic b, sd_pro_route_traffic_detail c where b.id = c.plan_id and b.is_del = 0 and c.is_del = 0 group by b.route_id) h,
				(select count(b.id) as BASE_PRICE_CNT,b.entity_id from SD_PRO_BASE_PRICE b group by b.entity_id ) h1,
				(SELECT route_id,
				    LTRIM(MAX(SYS_CONNECT_BY_PATH(tag_name, ',')), ',') themes
				  FROM
				    (SELECT tag_name,
				      route_id,
				      ROW_NUMBER() OVER(PARTITION BY route_id ORDER BY tag_name DESC) RN
				    FROM sd_pro_route_tag
				    )
				    START WITH RN     = 1
				    CONNECT BY RN - 1 = PRIOR RN
				  AND route_id        = PRIOR route_id
				  GROUP BY route_id
				  )h2,
				  (SELECT route_id,
				    LTRIM(MAX(SYS_CONNECT_BY_PATH(CITY_NAME, ',')), ',') begin_city
				  FROM
				    (SELECT CITY_NAME,
				      route_id,
				      ROW_NUMBER() OVER(PARTITION BY route_id ORDER BY CITY_NAME DESC) RN
				    FROM SD_PRO_ROUTE_CITY
				    WHERE type = 1
				    )
				    START WITH RN     = 1
				    CONNECT BY RN - 1 = PRIOR RN
				  AND route_id        = PRIOR route_id
				  GROUP BY route_id
				  )h3,
				  (SELECT route_id,
				    LTRIM(MAX(SYS_CONNECT_BY_PATH(CITY_NAME, ',')), ',') end_city
				  FROM
				    (SELECT CITY_NAME,
				      route_id,
				      ROW_NUMBER() OVER(PARTITION BY route_id ORDER BY CITY_NAME DESC) RN
				    FROM SD_PRO_ROUTE_CITY
				    WHERE type = 2
				    )
				    START WITH RN     = 1
				    CONNECT BY RN - 1 = PRIOR RN
				  AND route_id        = PRIOR route_id
				  GROUP BY route_id
				  )h4,
				  (SELECT t.PRO_ID,
			  t.DISCOUNT_ID,
			  t.title||'('||MAX(SYS_CONNECT_BY_PATH(t.discount_info, ' 套餐*：'))||')' as discount_info
			FROM
			  (SELECT t.PRO_ID,
			    t.DISCOUNT_ID,
			    t1.title,
			    DECODE(t2.PLATFROM, '1','B2B','APP') || DECODE(t2.PAY_WAY, '1','在线支付','余额支付') || ' 优惠: ' || to_char(t2.MONEY,'fm99999990.99')|| DECODE(t2.rule_type, '1', '元', '%') as discount_info,
			    ROW_NUMBER() OVER(PARTITION BY t.PRO_ID order by t1.title) RN
			  FROM SD_DISCOUNT_PRODUCT t,
			    SD_DISCOUNT t1,
			    sd_discount_rule t2
			  WHERE t.discount_id    = t1.id
			  AND t.discount_rule_id = t2.id
			  AND t1.is_use          = 0
			  AND t2.is_use          = 0
			  <![CDATA[  AND t1.BEGIN_TIME <= sysdate ]]>
			  AND t1.END_TIME   >= sysdate
			  ) t
			  START WITH t.RN     = 1
			  CONNECT BY t.RN - 1 = PRIOR t.RN
			AND t.PRO_ID          = PRIOR t.PRO_ID
			GROUP BY t.PRO_ID,
			  t.DISCOUNT_ID,
			  t.title) h5,
			  (select * from sd_wap_price where AGENCY_ID = #AGENCY_ID#) h6
				WHERE a.ID = b.ROUTE_ID and a.CREATE_USER_ID = c.ID and a.COMPANY_ID = d.ID
				
				AND a.id             = h.route_id(+)
				AND a.id             = h1.entity_id(+)
				AND a.id             = h2.route_id(+)
				AND a.id             = h3.ROUTE_ID(+)
				AND a.id             = h4.ROUTE_ID(+)
				
				and a.id             = h6.pro_id(+)
				<isNotEmpty property="DISCOUNT">
				and a.id             = h5.pro_id
				</isNotEmpty>
				<isEmpty property="DISCOUNT">
				and a.id             = h5.pro_id(+)
				</isEmpty>
				
				<isNotEmpty property="query">
					AND ( a.TITLE         like '%$query$%' or a.NO like '%$query$%' or h4.end_city like  '%$query$%')
				</isNotEmpty>
				<isNotEmpty property="BRAND_NAME">
					and 
					 <iterate property="BRAND_NAME" conjunction="or" open="(" close=")">
					 d.BRAND_NAME = #BRAND_NAME[]#
					 </iterate>
				</isNotEmpty>
				<isNotEmpty property="ID">
					and a.ID = #ID#
				</isNotEmpty>
				<isNotEmpty property="ROUTE_TYPE">
					and a.TYPE = #ROUTE_TYPE#
				</isNotEmpty>
				<isNotEmpty property="ATTR">
					and a.ATTR = #ATTR#
				</isNotEmpty>
			) a where 1 = 1 
			<isNotEmpty property="themes">
				and 
				 <iterate property="themes" conjunction="or" open="(" close=")">
				 a.themes like '%$themes[]$%'
				 </iterate>
			</isNotEmpty>
			<isNotEmpty property="attr">
				and a.attr = #attr#
			</isNotEmpty>
			<isNotEmpty property="DAY_COUNT">
				<isEqual property="DAY_COUNT" compareValue="7">
					<![CDATA[ and a.day_count >= 6 ]]>
				</isEqual>
				<isNotEqual property="DAY_COUNT" compareValue="7">
					and a.day_count = #DAY_COUNT#
				</isNotEqual>
			</isNotEmpty>
			<isNotEmpty property="MIN_PRICE">
				and a.SUM_INTER_PRICE >= #MIN_PRICE#
			</isNotEmpty>			
			<isNotEmpty property="MAX_PRICE">
				<![CDATA[ and a.SUM_INTER_PRICE <= #MAX_PRICE# ]]>
			</isNotEmpty>
			<isNotEmpty property="START_CITY_NAME"> 
				 <iterate property="START_CITY_NAME" conjunction="or" open="and (" close=")">
				 a.BEGIN_CITY like '%$START_CITY_NAME[]$%'
				 </iterate>
			</isNotEmpty>
			and a.ROUTE_TRAFFIC_CNT > 0
	</statement>
	
	<statement id="listSingleRouteDao" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select a.* from (select a.*, rownum as myrownum from (
			select * from (
				SELECT a.ID,
					a.NO,
					a.IS_EARNEST,
				    a.EARNEST_INTER,
				    a.EARNEST_RETAIL,
				    a.EARNEST_DAY_COUNT,
				    a.EARNEST_TYPE,
					a.FACE,
					a.TITLE,
					a.FEATURE,
					a.NOTICE,
					a.TYPE,
					a.COMPANY_ID,
					a.COMPANY_NAME,
					c.china_name as PORDUCE_CONCAT,
					c.mobile as PRODUCE_MOBILE,
					c.PHONE,
					a.CREATE_USER,
					TO_CHAR(a.CREATE_TIME, 'yyyy-mm-dd hh24:mm:ss') CREATE_TIME,
					a.CREATE_USER_ID,
					a.UPDATE_USER,
					TO_CHAR(a.UPDATE_TIME, 'yyyy-mm-dd hh24:mm:ss') UPDATE_TIME,
					a.UPDATE_USER_ID,
					a.CITY_ID,
					a.CITY_NAME,
					a.IS_DEL,
					a.IS_PUB,
					a.SOURCE_URL,
					a.IS_SINGLE_PUB,
					a.IS_GRANT,
					a.IS_SHARE,
					a.DAY_COUNT,
					a.ATTR,
					a.IS_OTHER_FEE,
					a.RETAIL_SINGLE_ROOM,
					a.INTER_SINGLE_ROOM,
					b.ROUTE_PRICE,
				    b.ROUTE_INTER_PRICE,
					c.QQ1,
					c.QQ2,
					DECODE(h.ROUTE_TRAFFIC_CNT, null, 0, h.ROUTE_TRAFFIC_CNT) ROUTE_TRAFFIC_CNT,
     		        DECODE(h1.BASE_PRICE_CNT, null, 0, h1.BASE_PRICE_CNT) BASE_PRICE_CNT,
					h2.themes,
					h3.begin_city,
					h4.end_city,
					a.IS_FULL_PRICE
				FROM
				  (
				  <isNotEmpty property="IS_ALONE">
					  SELECT a.ID,
							a.NO,
							a.IS_EARNEST,
						    a.EARNEST_INTER,
						    a.EARNEST_RETAIL,
						    a.EARNEST_DAY_COUNT,
						    a.EARNEST_TYPE,
							a.FACE,
							a.TITLE,
							a.FEATURE,
							a.NOTICE,
							a.TYPE,
							a.COMPANY_ID,
							a.COMPANY_NAME,
							a.PORDUCE_CONCAT,
							a.PRODUCE_MOBILE,
							a.CREATE_USER,
							a.CREATE_TIME,
							a.CREATE_USER_ID,
							a.UPDATE_USER,
							a.UPDATE_TIME,
							a.CITY_ID,
							a.CITY_NAME,
							a.IS_DEL,
							a.IS_PUB,
							a.SOURCE_URL,
							a.IS_SINGLE_PUB,
							a.IS_GRANT,
							a.IS_SHARE,
							a.UPDATE_USER_ID,
							a.DAY_COUNT,
							a.ATTR,
							a.CITY_NUM,
							a.SINGLE_REMARK,
							a.RETAIL_SINGLE_ROOM,
							a.INTER_SINGLE_ROOM,
							b.SALE_ROUTE,
							a.IS_OTHER_FEE,
							a.IS_FULL_PRICE
					  FROM sd_pro_route a, sd_user_company b
					  WHERE a.IS_SHARE = 1
					  AND a.IS_DEL     =0
					  AND a.IS_PUB     =1
					  and a.COMPANY_ID = b.id
					  and a.IS_SINGLE_PUB = 1
					  and b.SALE_ROUTE = 1
					  <isNotEmpty property="ID">
					  and a.ID = #ID#
					  </isNotEmpty>
					  <isNotEmpty property="CITY_IDS">
					  and a.CITY_ID in ($CITY_IDS$)
					  </isNotEmpty>
					  <isNotEmpty property="CITY_ID">
					  and a.CITY_ID = #CITY_ID#
					  </isNotEmpty>
					  <isNotEmpty property="NOTCOMPANYID">
					  and a.COMPANY_ID != #NOTCOMPANYID#
					  </isNotEmpty>
					  UNION
				  </isNotEmpty>
				  SELECT a.ID,
						a.NO,
						a.IS_EARNEST,
					    a.EARNEST_INTER,
					    a.EARNEST_RETAIL,
					    a.EARNEST_DAY_COUNT,
					    a.EARNEST_TYPE,
						a.FACE,
						a.TITLE,
						a.FEATURE,
						a.NOTICE,
						a.TYPE,
						a.COMPANY_ID,
						a.COMPANY_NAME,
						a.PORDUCE_CONCAT,
						a.PRODUCE_MOBILE,
						a.CREATE_USER,
						a.CREATE_TIME,
						a.CREATE_USER_ID,
						a.UPDATE_USER,
						a.UPDATE_TIME,
						a.CITY_ID,
						a.CITY_NAME,
						a.IS_DEL,
						a.IS_PUB,
						a.SOURCE_URL,
						a.IS_SINGLE_PUB,
						a.IS_GRANT,
						a.IS_SHARE,
						a.UPDATE_USER_ID,
						a.DAY_COUNT,
						a.ATTR,
						a.CITY_NUM,
						a.SINGLE_REMARK,
						a.RETAIL_SINGLE_ROOM,
						a.INTER_SINGLE_ROOM,
						c.sale_route,
						a.IS_OTHER_FEE,
						a.IS_FULL_PRICE
				  FROM SD_PRO_ROUTE a,
				    SD_PRO_ROUTE_GRANT b,
				    sd_user_company c
				  WHERE a.ID       = b.ROUTE_ID
				  AND a.IS_DEL     =0
				  AND a.IS_PUB     =1
				  AND a.COMPANY_ID = c.ID
				  and a.IS_SINGLE_PUB = 1
				  and c.SALE_ROUTE = 1
				  <isNotEmpty property="ID">
				  and a.ID = #ID#
				  </isNotEmpty>
				  <isNotEmpty property="COMPANY_ID">
				  and b.COMPANY_ID = #COMPANY_ID#
				  </isNotEmpty> 
				  <isNotEmpty property="CITY_IDS">
				  and a.CITY_ID in ($CITY_IDS$)
				  </isNotEmpty>
				  <isNotEmpty property="CITY_ID">
				  and a.CITY_ID = #CITY_ID#
				  </isNotEmpty>
				  <isNotEmpty property="NOTCOMPANYID">
				  and a.COMPANY_ID != #NOTCOMPANYID#
				  </isNotEmpty>
				  ) a,
				  (SELECT b.ENTITY_ID as ROUTE_ID,
				    b.ROUTE_PRICE,
				    b.ROUTE_INTER_PRICE
				  FROM
				    (SELECT a.entity_id,
				      SUM(DECODE(a.TYPE_ID, '0FA5123749D28C87E050007F0100BCAD', a.PRICE,0)) AS ROUTE_PRICE,
				      SUM(DECODE(a.TYPE_ID, '0FA5123749D38C87E050007F0100BCAD', a.PRICE,0)) AS ROUTE_INTER_PRICE
				    FROM SD_PRO_BASE_PRICE a
				    WHERE a.ATTR_ID = '0FA5123749CF8C87E050007F0100BCAD'
				    GROUP BY a.ENTITY_ID
				    ) b,
				    sd_pro_route_city_labels c
				  WHERE b.ENTITY_ID = c.route_id(+)
				  <isNotEmpty property="LABEL_IDS">
					and 
					 <iterate property="LABEL_IDS" conjunction="or" open="(" close=")">
					 c.label_ids like '%$LABEL_IDS[]$%'
					 </iterate>
				  </isNotEmpty> 
				  ) b, SD_USER c, SD_USER_COMPANY d,
		        (select count(b.id) as ROUTE_TRAFFIC_CNT , b.route_id from sd_pro_route_traffic b, sd_pro_route_traffic_detail c where b.id = c.plan_id and b.is_del = 0 and c.is_del = 0 group by b.route_id) h,

				(select count(b.id) as BASE_PRICE_CNT,b.entity_id from SD_PRO_BASE_PRICE b group by b.entity_id ) h1,
				(SELECT route_id,
				    LTRIM(MAX(SYS_CONNECT_BY_PATH(tag_name, ',')), ',') themes
				  FROM
				    (SELECT tag_name,
				      route_id,
				      ROW_NUMBER() OVER(PARTITION BY route_id ORDER BY tag_name DESC) RN
				    FROM sd_pro_route_tag
				    )
				    START WITH RN     = 1
				    CONNECT BY RN - 1 = PRIOR RN
				  AND route_id        = PRIOR route_id
				  GROUP BY route_id
				  )h2,
				  (SELECT route_id,
				    LTRIM(MAX(SYS_CONNECT_BY_PATH(CITY_NAME, ',')), ',') begin_city
				  FROM
				    (SELECT CITY_NAME,
				      route_id,
				      ROW_NUMBER() OVER(PARTITION BY route_id ORDER BY CITY_NAME DESC) RN
				    FROM SD_PRO_ROUTE_CITY
				    WHERE type = 1
				    )
				    START WITH RN     = 1
				    CONNECT BY RN - 1 = PRIOR RN
				  AND route_id        = PRIOR route_id
				  GROUP BY route_id
				  )h3,
				  (SELECT route_id,
				    LTRIM(MAX(SYS_CONNECT_BY_PATH(CITY_NAME, ',')), ',') end_city
				  FROM
				    (SELECT CITY_NAME,
				      route_id,
				      ROW_NUMBER() OVER(PARTITION BY route_id ORDER BY CITY_NAME DESC) RN
				    FROM SD_PRO_ROUTE_CITY
				    WHERE type = 2
				    )
				    START WITH RN     = 1
				    CONNECT BY RN - 1 = PRIOR RN
				  AND route_id        = PRIOR route_id
				  GROUP BY route_id
				  )h4
				WHERE a.ID = b.ROUTE_ID and a.CREATE_USER_ID = c.ID and a.COMPANY_ID = d.ID
				
				AND a.id             = h.route_id(+)
				AND a.id             = h1.entity_id(+)
				AND a.id             = h2.route_id(+)
				AND a.id             = h3.ROUTE_ID(+)
				AND a.id             = h4.ROUTE_ID(+)
				
				<isNotEmpty property="query">
					AND ( a.TITLE         like '%$query$%' or a.NO like '%$query$%' or h4.end_city like  '%$query$%')
				</isNotEmpty>
				<isNotEmpty property="BRAND_NAME">
					and 
					 <iterate property="BRAND_NAME" conjunction="or" open="(" close=")">
					 d.BRAND_NAME = #BRAND_NAME[]#
					 </iterate>
				</isNotEmpty>
				<isNotEmpty property="ID">
					and a.ID = #ID#
				</isNotEmpty>
				<isNotEmpty property="ROUTE_TYPE">
					and a.TYPE = #ROUTE_TYPE#
				</isNotEmpty>
				<isNotEmpty property="ATTR">
					and a.ATTR = #ATTR#
				</isNotEmpty>
			) a where 1 = 1 
			<isNotEmpty property="themes">
				and 
				 <iterate property="themes" conjunction="or" open="(" close=")">
				 a.themes like '%$themes[]$%'
				 </iterate>
			</isNotEmpty>
			<isNotEmpty property="DAY_COUNT">
				<isEqual property="DAY_COUNT" compareValue="7">
					<![CDATA[ and a.day_count >= 6 ]]>
				</isEqual>
				<isNotEqual property="DAY_COUNT" compareValue="7">
					and a.day_count = #DAY_COUNT#
				</isNotEqual>
			</isNotEmpty>
			<isNotEmpty property="MIN_PRICE">
				and a.SUM_INTER_PRICE >= #MIN_PRICE#
			</isNotEmpty>			
			<isNotEmpty property="MAX_PRICE">
				<![CDATA[ and a.SUM_INTER_PRICE <= #MAX_PRICE# ]]>
			</isNotEmpty>
			<isNotEmpty property="START_CITY_NAME"> 
				 <iterate property="START_CITY_NAME" conjunction="or" open="and (" close=")">
				 a.BEGIN_CITY like '%$START_CITY_NAME[]$%'
				 </iterate>
			</isNotEmpty>
			ORDER BY a.UPDATE_TIME DESC
  		)a)a where 1 = 1 <![CDATA[  and a.myrownum >= #start# and a.myrownum <= #end# ]]>
	</statement>
	
	<statement id="countSingleRouteDao" parameterClass="java.util.Map" resultClass="java.lang.Integer">
			select count(1) as cnt from (
				SELECT a.ID,
					a.NO,
					a.FACE,
					a.TITLE,
					a.FEATURE,
					a.NOTICE,
					a.TYPE,
					a.COMPANY_ID,
					a.COMPANY_NAME,
					c.china_name as PORDUCE_CONCAT,
					c.mobile as PRODUCE_MOBILE,
					c.PHONE,
					a.CREATE_USER,
					TO_CHAR(a.CREATE_TIME, 'yyyy-mm-dd hh24:mm:ss') CREATE_TIME,
					a.CREATE_USER_ID,
					a.UPDATE_USER,
					TO_CHAR(a.UPDATE_TIME, 'yyyy-mm-dd hh24:mm:ss') UPDATE_TIME,
					a.UPDATE_USER_ID,
					a.CITY_ID,
					a.CITY_NAME,
					a.IS_DEL,
					a.IS_PUB,
					a.SOURCE_URL,
					a.IS_SINGLE_PUB,
					a.IS_GRANT,
					a.IS_SHARE,
					a.DAY_COUNT,
					a.ATTR,
					a.RETAIL_SINGLE_ROOM,
					a.INTER_SINGLE_ROOM,
					b.ROUTE_PRICE,
				    b.ROUTE_INTER_PRICE,
					c.QQ1,
					c.QQ2,
					DECODE(h.ROUTE_TRAFFIC_CNT, null, 0, h.ROUTE_TRAFFIC_CNT) ROUTE_TRAFFIC_CNT,
     		        DECODE(h1.BASE_PRICE_CNT, null, 0, h1.BASE_PRICE_CNT) BASE_PRICE_CNT,
					h2.themes,
					h3.begin_city,
					h4.end_city
				FROM
				  (
				  <isNotEmpty property="IS_ALONE">
					  SELECT a.ID,
							a.NO,
							a.FACE,
							a.TITLE,
							a.FEATURE,
							a.NOTICE,
							a.TYPE,
							a.COMPANY_ID,
							a.COMPANY_NAME,
							a.PORDUCE_CONCAT,
							a.PRODUCE_MOBILE,
							a.CREATE_USER,
							a.CREATE_TIME,
							a.CREATE_USER_ID,
							a.UPDATE_USER,
							a.UPDATE_TIME,
							a.CITY_ID,
							a.CITY_NAME,
							a.IS_DEL,
							a.IS_PUB,
							a.SOURCE_URL,
							a.IS_SINGLE_PUB,
							a.IS_GRANT,
							a.IS_SHARE,
							a.UPDATE_USER_ID,
							a.DAY_COUNT,
							a.ATTR,
							a.CITY_NUM,
							a.SINGLE_REMARK,
							a.RETAIL_SINGLE_ROOM,
							a.INTER_SINGLE_ROOM,
							b.sale_route
					  FROM sd_pro_route a, sd_user_company b
					  WHERE a.IS_SHARE = 1
					  AND a.IS_DEL     =0
					  AND a.IS_PUB     =1
					  and a.COMPANY_ID = b.id
					  and a.IS_SINGLE_PUB = 1
					  and b.SALE_ROUTE = 1
					  <isNotEmpty property="ID">
					  and a.ID = #ID#
					  </isNotEmpty>
					  <isNotEmpty property="CITY_IDS">
					  and a.CITY_ID in ($CITY_IDS$)
					  </isNotEmpty>
					  <isNotEmpty property="CITY_ID">
					  and a.CITY_ID = #CITY_ID#
					  </isNotEmpty>
					  <isNotEmpty property="NOTCOMPANYID">
					  and a.COMPANY_ID != #NOTCOMPANYID#
					  </isNotEmpty>
					  UNION
				  </isNotEmpty>
				  SELECT a.ID,
						a.NO,
						a.FACE,
						a.TITLE,
						a.FEATURE,
						a.NOTICE,
						a.TYPE,
						a.COMPANY_ID,
						a.COMPANY_NAME,
						a.PORDUCE_CONCAT,
						a.PRODUCE_MOBILE,
						a.CREATE_USER,
						a.CREATE_TIME,
						a.CREATE_USER_ID,
						a.UPDATE_USER,
						a.UPDATE_TIME,
						a.CITY_ID,
						a.CITY_NAME,
						a.IS_DEL,
						a.IS_PUB,
						a.SOURCE_URL,
						a.IS_SINGLE_PUB,
						a.IS_GRANT,
						a.IS_SHARE,
						a.UPDATE_USER_ID,
						a.DAY_COUNT,
						a.ATTR,
						a.CITY_NUM,
						a.SINGLE_REMARK,
						a.RETAIL_SINGLE_ROOM,
						a.INTER_SINGLE_ROOM,
						c.sale_route
				  FROM SD_PRO_ROUTE a,
				    SD_PRO_ROUTE_GRANT b,
				    sd_user_company c
				  WHERE a.ID       = b.ROUTE_ID
				  AND a.IS_DEL     =0
				  AND a.IS_PUB     =1
				  AND a.COMPANY_ID = c.ID
				  and a.IS_SINGLE_PUB = 1
				  and c.SALE_ROUTE = 1
				  <isNotEmpty property="ID">
				  and a.ID = #ID#
				  </isNotEmpty>
				  <isNotEmpty property="COMPANY_ID">
				  and b.COMPANY_ID = #COMPANY_ID#
				  </isNotEmpty> 
				  <isNotEmpty property="CITY_IDS">
				  and a.CITY_ID in ($CITY_IDS$)
				  </isNotEmpty>
				  <isNotEmpty property="CITY_ID">
				  and a.CITY_ID = #CITY_ID#
				  </isNotEmpty>
				  <isNotEmpty property="NOTCOMPANYID">
				  and a.COMPANY_ID != #NOTCOMPANYID#
				  </isNotEmpty>
				  ) a,
				  (SELECT b.ENTITY_ID as ROUTE_ID,
				    b.ROUTE_PRICE,
				    b.ROUTE_INTER_PRICE
				  FROM
				    (SELECT a.entity_id,
				      SUM(DECODE(a.TYPE_ID, '0FA5123749D28C87E050007F0100BCAD', a.PRICE,0)) AS ROUTE_PRICE,
				      SUM(DECODE(a.TYPE_ID, '0FA5123749D38C87E050007F0100BCAD', a.PRICE,0)) AS ROUTE_INTER_PRICE
				    FROM SD_PRO_BASE_PRICE a
				    WHERE a.ATTR_ID = '0FA5123749CF8C87E050007F0100BCAD'
				    GROUP BY a.ENTITY_ID
				    ) b,
				    sd_pro_route_city_labels c
				  WHERE b.ENTITY_ID = c.route_id(+)
				  <isNotEmpty property="LABEL_IDS">
					and 
					 <iterate property="LABEL_IDS" conjunction="or" open="(" close=")">
					 c.label_ids like '%$LABEL_IDS[]$%'
					 </iterate>
				  </isNotEmpty> 
				  ) b, SD_USER c, SD_USER_COMPANY d,
		        (select count(b.id) as ROUTE_TRAFFIC_CNT , b.route_id from sd_pro_route_traffic b, sd_pro_route_traffic_detail c where b.id = c.plan_id and b.is_del = 0 and c.is_del = 0 group by b.route_id) h,
				(select count(b.id) as BASE_PRICE_CNT,b.entity_id from SD_PRO_BASE_PRICE b group by b.entity_id ) h1,
				(SELECT route_id,
				    LTRIM(MAX(SYS_CONNECT_BY_PATH(tag_name, ',')), ',') themes
				  FROM
				    (SELECT tag_name,
				      route_id,
				      ROW_NUMBER() OVER(PARTITION BY route_id ORDER BY tag_name DESC) RN
				    FROM sd_pro_route_tag
				    )
				    START WITH RN     = 1
				    CONNECT BY RN - 1 = PRIOR RN
				  AND route_id        = PRIOR route_id
				  GROUP BY route_id
				  )h2,
				  (SELECT route_id,
				    LTRIM(MAX(SYS_CONNECT_BY_PATH(CITY_NAME, ',')), ',') begin_city
				  FROM
				    (SELECT CITY_NAME,
				      route_id,
				      ROW_NUMBER() OVER(PARTITION BY route_id ORDER BY CITY_NAME DESC) RN
				    FROM SD_PRO_ROUTE_CITY
				    WHERE type = 1
				    )
				    START WITH RN     = 1
				    CONNECT BY RN - 1 = PRIOR RN
				  AND route_id        = PRIOR route_id
				  GROUP BY route_id
				  )h3,
				  (SELECT route_id,
				    LTRIM(MAX(SYS_CONNECT_BY_PATH(CITY_NAME, ',')), ',') end_city
				  FROM
				    (SELECT CITY_NAME,
				      route_id,
				      ROW_NUMBER() OVER(PARTITION BY route_id ORDER BY CITY_NAME DESC) RN
				    FROM SD_PRO_ROUTE_CITY
				    WHERE type = 2
				    )
				    START WITH RN     = 1
				    CONNECT BY RN - 1 = PRIOR RN
				  AND route_id        = PRIOR route_id
				  GROUP BY route_id
				  )h4
				WHERE a.ID = b.ROUTE_ID and a.UPDATE_USER_ID = c.ID and a.COMPANY_ID = d.ID
				
				AND a.id             = h.route_id(+)
				AND a.id             = h1.entity_id(+)
				AND a.id             = h2.route_id(+)
				AND a.id             = h3.ROUTE_ID(+)
				AND a.id             = h4.ROUTE_ID(+)
				
				<isNotEmpty property="query">
					AND ( a.TITLE         like '%$query$%' or a.NO like '%$query$%' or h4.end_city like  '%$query$%')
				</isNotEmpty>
				<isNotEmpty property="BRAND_NAME">
					and 
					 <iterate property="BRAND_NAME" conjunction="or" open="(" close=")">
					 d.BRAND_NAME = #BRAND_NAME[]#
					 </iterate>
				</isNotEmpty>
				<isNotEmpty property="ID">
					and a.ID = #ID#
				</isNotEmpty>
				<isNotEmpty property="ROUTE_TYPE">
					and a.TYPE = #ROUTE_TYPE#
				</isNotEmpty>
				<isNotEmpty property="ATTR">
					and a.ATTR = #ATTR#
				</isNotEmpty>
			) a where 1 = 1 
			<isNotEmpty property="themes">
				and 
				 <iterate property="themes" conjunction="or" open="(" close=")">
				 a.themes like '%$themes[]$%'
				 </iterate>
			</isNotEmpty>
			<isNotEmpty property="DAY_COUNT">
				<isEqual property="DAY_COUNT" compareValue="7">
					<![CDATA[ and a.day_count >= 6 ]]>
				</isEqual>
				<isNotEqual property="DAY_COUNT" compareValue="7">
					and a.day_count = #DAY_COUNT#
				</isNotEqual>
			</isNotEmpty>
			<isNotEmpty property="MIN_PRICE">
				and a.SUM_INTER_PRICE >= #MIN_PRICE#
			</isNotEmpty>			
			<isNotEmpty property="MAX_PRICE">
				<![CDATA[ and a.SUM_INTER_PRICE <= #MAX_PRICE# ]]>
			</isNotEmpty>
			<isNotEmpty property="START_CITY_NAME"> 
				 <iterate property="START_CITY_NAME" conjunction="or" open="and (" close=")">
				 a.BEGIN_CITY like '%$START_CITY_NAME[]$%'
				 </iterate>
			</isNotEmpty>
	</statement>
	
	<statement id="listCompanyDao" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		SELECT DISTINCT c.BRAND_NAME, c.BRAND_PY, c.BRAND_JP, count(1) as cnt
		FROM
		  (
		  <isNotEmpty property="IS_ALONE">
			  SELECT a.ID,
					a.NO,
					a.FACE,
					a.TITLE,
					a.FEATURE,
					a.NOTICE,
					a.TYPE,
					a.COMPANY_ID,
					a.COMPANY_NAME,
					a.PORDUCE_CONCAT,
					a.PRODUCE_MOBILE,
					a.CREATE_USER,
					a.CREATE_TIME,
					a.CREATE_USER_ID,
					a.UPDATE_USER,
					a.UPDATE_TIME,
					a.CITY_ID,
					a.CITY_NAME,
					a.IS_DEL,
					a.IS_PUB,
					a.SOURCE_URL,
					a.IS_SINGLE_PUB,
					a.IS_GRANT,
					a.IS_SHARE,
					a.UPDATE_USER_ID,
					a.DAY_COUNT,
					a.ATTR,
					a.CITY_NUM,
					a.SINGLE_REMARK,
					a.RETAIL_SINGLE_ROOM,
					a.INTER_SINGLE_ROOM
			  FROM sd_pro_route a
			  WHERE a.IS_SHARE = 1
			  AND a.IS_DEL     =0
			  AND a.IS_PUB     =1
			  <isNotEmpty property="CITY_IDS">
			  and a.CITY_ID in ($CITY_IDS$)
			  </isNotEmpty>
			  <isNotEmpty property="CITY_ID">
			  and a.CITY_ID = #CITY_ID#
			  </isNotEmpty>
			  <isNotEmpty property="IS_SINGLE_PUB">
			  and a.IS_SINGLE_PUB = #IS_SINGLE_PUB#
			  </isNotEmpty>
			  <isNotEmpty property="NOTCOMPANYID">
			  and a.COMPANY_ID != #NOTCOMPANYID#
			  </isNotEmpty>
			  <isNotEmpty property="ROUTE_TYPE">
			  and a.TYPE = #ROUTE_TYPE# 
			  </isNotEmpty>
			  UNION
		  </isNotEmpty>
		  SELECT a.ID,
				a.NO,
				a.FACE,
				a.TITLE,
				a.FEATURE,
				a.NOTICE,
				a.TYPE,
				a.COMPANY_ID,
				a.COMPANY_NAME,
				a.PORDUCE_CONCAT,
				a.PRODUCE_MOBILE,
				a.CREATE_USER,
				a.CREATE_TIME,
				a.CREATE_USER_ID,
				a.UPDATE_USER,
				a.UPDATE_TIME,
				a.CITY_ID,
				a.CITY_NAME,
				a.IS_DEL,
				a.IS_PUB,
				a.SOURCE_URL,
				a.IS_SINGLE_PUB,
				a.IS_GRANT,
				a.IS_SHARE,
				a.UPDATE_USER_ID,
				a.DAY_COUNT,
				a.ATTR,
				a.CITY_NUM,
				a.SINGLE_REMARK,
				a.RETAIL_SINGLE_ROOM,
				a.INTER_SINGLE_ROOM
		  FROM SD_PRO_ROUTE a,
		    SD_PRO_ROUTE_GRANT b
		  WHERE a.ID       = b.ROUTE_ID
		  AND a.IS_DEL     =0
		  AND a.IS_PUB     =1
		  <isNotEmpty property="ROUTE_TYPE">
		  and a.TYPE = #ROUTE_TYPE# 
		  </isNotEmpty>
		  <isNotEmpty property="COMPANY_ID">
		  and b.COMPANY_ID = #COMPANY_ID#
		  </isNotEmpty> 
		  <isNotEmpty property="CITY_IDS">
		  and a.CITY_ID in ($CITY_IDS$)
		  </isNotEmpty>
		  <isNotEmpty property="CITY_ID">
		  and a.CITY_ID = #CITY_ID#
		  </isNotEmpty>
		  <isNotEmpty property="IS_SINGLE_PUB">
		  and a.IS_SINGLE_PUB = #IS_SINGLE_PUB#
		  </isNotEmpty>
		  <isNotEmpty property="NOTCOMPANYID">
		  and a.COMPANY_ID != #NOTCOMPANYID#
		  </isNotEmpty>
		  ) a,
		  <isEmpty property="IS_SINGLE_PUB">
		  (SELECT a.route_id
		      FROM SD_PRO_ROUTE_CALENDAR a
		      <![CDATA[ WHERE TO_CHAR((to_date(TO_CHAR(sysdate, 'yyyymmdd hh24:mi'),'yyyymmdd hh24:mi') + a.DAY_NUM),'yyyymmdd hh24:mi') <= a.rq
			    ||' '
			    || a.END_TIME
			  ]]>
			  <isNotEmpty property="BEGIN_DATE">
			  	and a.RQ >= to_date(#BEGIN_DATE#, 'yyyy-mm-dd')
			  </isNotEmpty>
				
			  <isNotEmpty property="END_DATE">
			  	<![CDATA[ and a.RQ <= to_date(#END_DATE#, 'yyyy-mm-dd') ]]>
			  </isNotEmpty>
			  GROUP BY a.route_id
		  ) b,
		  </isEmpty>
		  sd_user_company c
		  
		WHERE a.COMPANY_ID = c.id
		<isNotEmpty property="IS_COUNTRY">
		and c.IS_COUNTRY = 1  
		</isNotEmpty>
		<isNotEmpty property="IS_WORLD">
		and c.IS_WORLD = 1  
		</isNotEmpty>
		<isEmpty property="IS_SINGLE_PUB">
		AND a.id       = b.route_id
		</isEmpty>
		group by c.BRAND_NAME,
		  c.BRAND_PY,
		  c.BRAND_JP
	</statement>
	
	<statement id="listLabelDao" parameterClass="java.util.Map" resultClass="java.util.HashMap" remapResults="true">
		SELECT DISTINCT 
		  <isNotEmpty property="LABEL_ID">
		  c.city_id,
		  c.city_name,
		  </isNotEmpty>
		  e.id,
		  e.text,
		  e.type
		FROM
		  (
		  <isNotEmpty property="IS_ALONE">
			  SELECT a.ID,
				a.NO,
				a.FACE,
				a.TITLE,
				a.FEATURE,
				a.NOTICE,
				a.TYPE,
				a.COMPANY_ID,
				a.COMPANY_NAME,
				a.PORDUCE_CONCAT,
				a.PRODUCE_MOBILE,
				a.CREATE_USER,
				a.CREATE_TIME,
				a.CREATE_USER_ID,
				a.UPDATE_USER,
				a.UPDATE_TIME,
				a.CITY_ID,
				a.CITY_NAME,
				a.IS_DEL,
				a.IS_PUB,
				a.SOURCE_URL,
				a.IS_SINGLE_PUB,
				a.IS_GRANT,
				a.IS_SHARE,
				a.UPDATE_USER_ID,
				a.DAY_COUNT,
				a.ATTR,
				a.CITY_NUM,
				a.SINGLE_REMARK,
				a.RETAIL_SINGLE_ROOM,
				a.INTER_SINGLE_ROOM
			  FROM sd_pro_route a
			  WHERE a.IS_SHARE = 1
			  AND a.IS_DEL     =0
			  AND a.IS_PUB     =1
			  <isNotEmpty property="CITY_IDS">
			  and a.CITY_ID in ($CITY_IDS$)
			  </isNotEmpty>
			  <isNotEmpty property="CITY_ID">
			  and a.CITY_ID = #CITY_ID#
			  </isNotEmpty>
			  <isNotEmpty property="IS_SINGLE_PUB">
			  and a.IS_SINGLE_PUB = #IS_SINGLE_PUB#
			  </isNotEmpty>
			  <isNotEmpty property="NOTCOMPANYID">
			  and a.COMPANY_ID != #NOTCOMPANYID#
			  </isNotEmpty>
			  UNION
		  </isNotEmpty>
		  SELECT a.ID,
				a.NO,
				a.FACE,
				a.TITLE,
				a.FEATURE,
				a.NOTICE,
				a.TYPE,
				a.COMPANY_ID,
				a.COMPANY_NAME,
				a.PORDUCE_CONCAT,
				a.PRODUCE_MOBILE,
				a.CREATE_USER,
				a.CREATE_TIME,
				a.CREATE_USER_ID,
				a.UPDATE_USER,
				a.UPDATE_TIME,
				a.CITY_ID,
				a.CITY_NAME,
				a.IS_DEL,
				a.IS_PUB,
				a.SOURCE_URL,
				a.IS_SINGLE_PUB,
				a.IS_GRANT,
				a.IS_SHARE,
				a.UPDATE_USER_ID,
				a.DAY_COUNT,
				a.ATTR,
				a.CITY_NUM,
				a.SINGLE_REMARK,
				a.RETAIL_SINGLE_ROOM,
				a.INTER_SINGLE_ROOM
		  FROM SD_PRO_ROUTE a,
		    SD_PRO_ROUTE_GRANT b
		  WHERE a.ID       = b.ROUTE_ID
		  AND a.IS_DEL     =0
		  AND a.IS_PUB     =1
		  
		  <isNotEmpty property="COMPANY_ID">
		  and b.COMPANY_ID = #COMPANY_ID#
		  </isNotEmpty> 
		  <isNotEmpty property="CITY_IDS">
		  and a.CITY_ID in ($CITY_IDS$)
		  </isNotEmpty>
		  <isNotEmpty property="CITY_ID">
		  and a.CITY_ID = #CITY_ID#
		  </isNotEmpty>
		  <isNotEmpty property="IS_SINGLE_PUB">
		  and a.IS_SINGLE_PUB = #IS_SINGLE_PUB#
		  </isNotEmpty>
		  <isNotEmpty property="NOTCOMPANYID">
		  and a.COMPANY_ID != #NOTCOMPANYID#
		  </isNotEmpty>
		  ) a,
		  <isEmpty property="IS_SINGLE_PUB">
		  (SELECT a.ROUTE_ID
		  FROM SD_PRO_ROUTE_CALENDAR a
		  <![CDATA[ WHERE TO_CHAR((to_date(TO_CHAR(sysdate, 'yyyymmdd hh24:mi'),'yyyymmdd hh24:mi') + a.DAY_NUM),'yyyymmdd hh24:mi') <= a.rq
		    ||' '
		    || a.END_TIME
		  ]]>
	  	  <isNotEmpty property="BEGIN_DATE">
		  	and a.RQ >= to_date(#BEGIN_DATE#, 'yyyy-mm-dd')
		  </isNotEmpty>
			
		  <isNotEmpty property="END_DATE">
		  	<![CDATA[ and a.RQ <= to_date(#END_DATE#, 'yyyy-mm-dd') ]]>
		  </isNotEmpty>
		  GROUP BY a.route_id
		  ) b,
		  </isEmpty>
		  SD_PRO_ROUTE_CITY c,
		  sd_city_label d,
		  sd_label e
		WHERE a.ID       = c.ROUTE_ID
		<isEmpty property="IS_SINGLE_PUB">
		AND a.ID     = b.ROUTE_ID
		</isEmpty>
		AND c.TYPE     = 2
		AND c.city_id  = d.entity_id
		and d.type != 2
		and a.type = e.type
		AND d.label_id = e.id
		<isNotEmpty property="TYPE">
			and e.type = #TYPE#
		</isNotEmpty>
		<isNotEmpty property="LABEL_ID">
			AND e.ID = #LABEL_ID#
		</isNotEmpty>
	</statement>
	
	<statement id="listRouteTrafficMusterDao" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		SELECT b.id, b.muster_time, b.muster_place
		FROM sd_pro_route_traffic_detail a,
		  sd_pro_traffic_muster b
		WHERE a.order_by = 1
		AND a.traffic_id = b.traffic_id
		AND a.is_del     = 0
		AND b.is_del     = 0
		AND a.plan_id    = #PLAN_ID#
	</statement>
	
	<insert id="saveWapPriceDao" parameterClass="java.util.Map">
		INSERT INTO 
		SD_WAP_PRICE values(
			#ID#,
			#AGENCY_ID#,
			#PRO_ID#,
			#PRICE#
		)
	</insert>
	
	<delete id="delWapPriceDao" parameterClass="java.util.Map">
		DELETE FROM SD_WAP_PRICE where PRO_ID = #PRO_ID#
	</delete>
	
	<statement id="listWapPriceDao" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		SELECT 
			a.ID,
			a.AGENCY_ID,
			a.PRO_ID,
			a.PRICE
		FROM SD_WAP_PRICE a
		WHERE 1 = 1
		<isNotEmpty property="PRO_ID">
		a.pro_id = #PRO_ID#
		</isNotEmpty>
	</statement>
	
</sqlMap>